# Домашняя работа

## Задание 1. Анализ и планирование

### 1. Описание функциональности монолитного приложения

**Управление отоплением:**

- Пользователь может включать и отключать отопление.
- Пользователь может регулировать отопление, через установку желаемой температуры.

**Мониторинг температуры:**

- Пользователь может просматривать текущую температуру через веб-интерфейс.

### 2. Анализ архитектуры монолитного приложения

- Технический аспект
  - Язык программирования: Java 17
  - Система сборки: Maven >=3.8.1 && <4.0.0
  - Библиотека логирования slf4j
  - База данных: PostgreSQL
  - Бэкенд.
    - Архитектура: монолит.
    - Взаимодействие с внешними приложениями: синхронное.
    - Масштабирование: невозможно, так как не настроен маршрутизатор позволяющий перенаправлять запросы от фронтенда.
    - Развертывание: для обновления требуется остановка монолита, так как нет маршрутизатора.
  - Фронтенд.
    - Передан на аутсорс.

### 3. Определение доменов и границы контекстов

- Текущее домены.
  - Домен мониторинга температуры.
    - Отвечает за мониторинг температуры и отправки данных в web интерфейс.
  - Домен управления отоплением.
    - Отвечает за вкл/выкл отопления и его регулирование в зависимости от температуры.
- Планируемые домены.
  - Домен управления устройствами.
    - Этот домен отдает устройствам команды.
    - Пример: Вкл/выкл свет, отопление, открыть/закрыть ворота и т.д.
  - Домен телеметрии.
    - Этот домен управляет собирает и хранить информацию о состоянии дома.
    - Пример: Текущая температура, открыты ли ворота и т.д.
  - Домен управление домом.
    - Единая точка сбора информации о доме. Позволяет отслеживать текущее состояние параметров дома(температура, влажност и т.д.) и задавать сценарии работы умных устройств.
      - Пример сценария: Включить отопление если температура упала ниже 20C и отключить если достигла 25С.
  - Домен управления пользователями.
    - Хранит данные о пользователе, логин, пароль, аватарка и т.д.

### 4. Проблемы монолитного решения

- Отсутствие масштабируемости. Любое обновление останавливает прод на неопределенное время.
- Низкая отказоустойчивость. При большой нагрузке вся система встанет, пользователь не сможет ни посмотреть температуру не отрегулировать отопление. Решается разделением монолита или ведением асинхронной обработки запросов в сам монолит.

### 5. Визуализация контекста системы — диаграмма С4

Данная диаграмма представляет из себя "as-is" описание текущего решения.

[Диаграмма систем](./docs/context_as_is.plantuml)

### Вывод по 1 заданию

- Во первых необходимо настроить маршрутизацию через ServiceMesh, чтобы обеспечить масштабируемость и повысить отказоустойчивость.
- Во вторых внедрить метрики для отслеживания нагрузки на куски кода связанные с конкретными доменами(Домен мониторинга температуры, Домен управления отоплением и т.д.). Чтобы при вынесении бизнес логики из монолита были объективные данные необходимости выделения конкретного домена в отдельный микросервис.
  - В рамках данной домашней работы я исхожу из предположения, что все домены необходимо выделить в отдельные микросервисы, так как предполагаемая нагрузка на сервис будет высокой.

## Задание 2. Проектирование микросервисной архитектуры

Диаграммы ниже представляют из себя "to-be" решения с учетом пожеланий компании.

- [Диаграмма систем](./docs/context_to_be.plantuml)
- [Диаграмма контейнера](./docs/container_to_be.plantuml)
- [Диаграмма компонентов, контейнер управления устройств](./docs/component_device_manager_to_be.plantuml)
- [Диаграмма кода, компонент управления отоплением](./docs/code_heat_component_to_be.plantuml)

## Задание 3. Разработка ER-диаграммы

- [ER диаграмма](./docs/er_diagram_to_be.plantuml)

Легенда ER диаграммы:

- Небольшое примечание, так как у каждого микросервиса своя БД, то Telemetry, DeviceType и Device будут отличаться в зависимости от микросервиса.
- Список сущностей.
  - User - пользователь системы.
  - House - дом пользователя системы.
  - DeviceType - тип устройств, содержит обобщенные параметры устройств.
  - Device - устройство.
  - Telemetry - тип для данных которые генерирует устройства.
    - Текущая температура, открыты ли ворота и т.д.
- Список связи.
  - User - House - много к многим. У пользователя может быть 0-N домов, у дома должен быть 1-N пользователей.
  - House - Device - один к многим. У дома может быть 0-N устройств, у устройств должен быть гарантировано 1 дом.
  - DeviceType - Device - один к многим. У типа устройств может быть 0-N устройств у устройств должен быть гарантировано 1 тип устройства.
  - Device - Telemetry - один к многим. Устройство может генерировать 0-N телеметрии. У телеметрии может быть только 1 источник(Устройство).
